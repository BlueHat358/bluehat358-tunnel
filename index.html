<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              dark: {
                bg: "#0D1117", // Background
                text: "#E5E5E5", // Teks utama
              },
              cold: {
                primary: "#3B82F6", // Biru (Primary)
                accent: "#38BDF8", // Cyan (Accent)
              },
            },
          },
        },
      };
    </script>
  </head>

  <body class="bg-dark-bg text-dark-text">
    <header class="mt-8">
      <h1 class="font-bold text-4xl text-center">Welcome to the Proxy List</h1>
      <h5 class="text-center text-2xl">BlueHat358</h5>
    </header>
    <main class="w-full">
      <div class="bg-dark-bg text-dark-text min-h-screen p-6">
        <div class="flex justify-between w-full mt-20">
          <div class="filters flex justify-between w-full">
            <div>
              <span class="filter-label text-dark-text">Item Page:</span>
              <select id="items-per-page" class="bg-dark-bg">
                <option value="10">10</option>
                <option value="25">25</option>
                <option value="50">50</option>
                <option value="100">100</option>
              </select>
            </div>
            <div>
              <span class="filter-label text-dark-text">Search:</span>
              <input
                type="text"
                id="search-bar"
                placeholder="Cari Isp, Country Code"
                class="bg-dark-bg border-cyan-200 border-2 rounded-md px-2 py-1"
              />
            </div>
          </div>
        </div>
        <table class="table-auto border-collapse w-full text-center mt-8">
          <thead>
            <tr>
              <th
                class="px-4 py-2 border-b text-cold-accent font-semibold w-12"
              >
                No
              </th>
              <th
                class="px-4 py-2 border-b text-cold-accent font-semibold w-60"
              >
                IP:Port
              </th>
              <th
                class="px-4 py-2 border-b text-cold-accent font-semibold w-60"
              >
                ISP | Country
              </th>
              <th
                class="px-4 py-2 border-b text-cold-accent font-semibold w-40"
              >
                Wildcard
              </th>
              <th
                class="px-4 py-2 border-b text-cold-accent font-semibold w-60"
              >
                Vless
              </th>
              <th
                class="px-4 py-2 border-b text-cold-accent font-semibold w-50"
              >
                Trojan
              </th>
              <th
                class="px-4 py-2 border-b text-cold-accent font-semibold w-50"
              >
                Shadowsock
              </th>
              <th
                class="px-4 py-2 border-b text-cold-accent font-semibold w-40"
              >
                Active
              </th>
            </tr>
          </thead>
          <tbody id="proxy-list"></tbody>
        </table>
      </div>
      <div
        class="total-proxy w-full flex justify-center text-md mt-10"
        id="total-proxy"
      ></div>
      <div
        class="pagination w-full flex justify-center gap-3 mt-6 mb-32 text-cold-primary text-xl"
        id="pagination"
      ></div>
    </main>
  </body>
  <footer class="footer flex justify-center">
    <h2>
      <p>
        &copy; 2024 BlueHat358 | Proudly built with Open Source Technologies.
      </p>
    </h2>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
    let proxyPerPage = 10;
    let currentPage = 1;
    let filteredProxies = [];
    let allProxies = [];

    const PROXY_HEALTH_CHECK_API = "https://api-proxy.bluehat358.us.kg";

    const workerUrl = "tun.bluehat358.us.kg";

    // Function to handle UUID generation
    function uuidv4() {
      return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, (c) =>
        (
          c ^
          (crypto.getRandomValues(new Uint8Array(1))[0] & (15 >> (c / 4)))
        ).toString(16)
      );
    }

    // Function to render proxies
    function renderProxies(proxies, proxyList, pagination) {
      const start = (currentPage - 1) * proxyPerPage;
      const end = start + proxyPerPage;
      const currentPageProxies = proxies.slice(start, end);

      proxyList.innerHTML = ""; // Clear previous list

      currentPageProxies.forEach((proxy) => {
        const [ip, port, country, isp] = proxy.split(",");
        const uuid = uuidv4();
        const nomor = proxies.indexOf(proxy) + 1;
        const row = document.createElement("tr");
        row.className =
          "odd:bg-dark-bg even:bg-cold-primary/10 hover:bg-cold-primary/40";
        row.innerHTML = `
            <!-- No -->
            <td class="px-4 py-2 border-b text-sm align-middle">${nomor}</td>
            <!-- Proxy IP -->
            <td class="px-4 py-2 border-b text-sm align-middle">${ip}:${port}</td>
            <!-- ISP | Country -->
            <td class="px-4 py-2 border-b text-sm align-middle">
              <div class="flex items-center gap-1">
                <span>${isp}</span> | <span>${country}</span
                ><span
                  class="flag-icon flag-icon-${country.toLowerCase()}"
                ></span>
              </div>
            </td>
            <!-- Wildcard -->
            <td class="px-4 py-2 border-b text-sm align-middle">
              <select
                class="w-full px-2 py-1 border rounded bg-dark-bg text-dark-text focus:ring focus:ring-cold-primary service-selector"
              >
                <option value="">No Wildcard</option>
                <option value="ava.game.naver.com">ava.game.naver.com</option>
                <option value="graph.instagram.com">graph.instagram.com</option>
                <option value="quiz.int.vidio.com">quiz.int.vidio.com</option>
                <option value="live.iflix.com.com">live.iflix.com</option>
                <option value="support.zoom.us">support.zoom.us</option>
                <option value="blog.webex.com">blog.webex.com</option>
                <option value="investors.spotify.com">
                  investors.spotify.com
                </option>
                <option value="cache.netflix.com">cache.netflix.com</option>
                <option value="zaintest.vuclip.com">zaintest.vuclip.com</option>
                <option value="io.ruangguru.com">io.ruangguru.com</option>
                <option value="api.midtrans.com">api.midtrans.com</option>
              </select>
            </td>
            <!-- Vless -->
            <td class="px-4 py-2 border-b text-sm align-middle">
              <div class="flex gap-2 mb-3">
                <button
                  class="copy-vless bg-cold-primary hover:bg-cold-accent text-dark-text px-2 py-1 rounded text-xs w-full"
                >
                  Vless 443
                </button>
                <button
                  class="copy-vless1 bg-cold-primary hover:bg-cold-accent text-dark-text px-2 py-1 rounded text-xs w-full"
                >
                  Vless 80
                </button>
              </div>
              <div class="flex gap-2">
                <button
                  class="copy-vless-clash bg-cold-primary hover:bg-cold-accent text-dark-text px-2 py-1 rounded text-xs w-full"
                >
                  CLASH 443
                </button>
                <button
                  class="copy-vless-clash1 bg-cold-primary hover:bg-cold-accent text-dark-text px-2 py-1 rounded text-xs w-full"
                >
                  CLASH 80
                </button>
              </div>
            </td>
            <!-- Trojan -->
            <td class="px-4 py-2 border-b text-sm align-middle">
              <div class="flex gap-2 mb-3">
                <button
                  class="copy-trojan bg-cold-primary hover:bg-cold-accent text-dark-text px-2 py-1 rounded text-xs w-full"
                >
                  Trojan 443
                </button>
              </div>
              <div class="flex gap-2">
                <button
                  class="copy-trojan-clash bg-cold-primary hover:bg-cold-accent text-dark-text px-2 py-1 rounded text-xs w-full"
                >
                  CLASH 443
                </button>
              </div>
            </td>
            <!-- Shadowsock -->
            <td class="px-4 py-2 border-b text-sm align-middle">
              <div class="flex gap-2 mb-3">
                <button
                  class="copy-shadowsock bg-cold-primary hover:bg-cold-accent text-dark-text px-2 py-1 rounded text-xs w-full"
                >
                  Shadowsock 443
                </button>
              </div>
              <div class="flex gap-2">
                <button
                  class="copy-shadowsock-clash bg-cold-primary hover:bg-cold-accent text-dark-text px-2 py-1 rounded text-xs w-full"
                >
                  CLASH 443
                </button>
              </div>
            </td>
            <!-- Active -->
            <td class="px-4 py-2 border-b text-sm align-middle">
              <div class="flex justify-center">
                <div>
                  <button
                    id="btn_active"
                    class="check_active bg-cold-primary hover:bg-cold-accent text-dark-bg px-2 py-1 rounded text-xs"
                    onclick="isProxyActive('${ip}', '${port}', this, ${nomor})"
                  >
                    Check
                  </button>
                  <div
                    class="flex items-center mt-2 gap-1 hidden" lat-wrap-index = "${nomor}"
                  >
                    <span class="bg-yellow-500 h-3 w-3 rounded-full"></span>
                    <span class="text-xs text-dark-text opacity-70 latency-cell"></span>
                  </div>
                </div>
              </div>
            </td>
          `;
        proxyList.appendChild(row);

        // Event listeners for copy buttons

        row.querySelector(".copy-vless").addEventListener("click", () => {
          const selectedService =
            row.querySelector(".service-selector").value || workerUrl;
          const domain =
            selectedService === workerUrl
              ? workerUrl
              : `${selectedService}.${workerUrl}`;
          const VLESS = `vless://${uuid}@${selectedService}:443?encryption=none&type=ws&host=${domain}&path=%2F${ip}-${port}&security=tls&sni=${domain}#(${selectedService})+${country}+${isp}`;
          navigator.clipboard.writeText(VLESS);
          Swal.fire({
            title: "Berhasil!",
            text: "COPY VLESS 443 SUKSES!",
            icon: "success",
            background: "rgba(6, 18, 67, 0.89)", // Warna latar belakang (biru pucat)
            color: "cyan", // Warna teks
            customClass: {
              popup: "rounded-popup",
            },
            confirmButtonColor: "#3085d6",
          });
        });

        row.querySelector(".copy-vless1").addEventListener("click", () => {
          const selectedService =
            row.querySelector(".service-selector").value || workerUrl;
          const domain =
            selectedService === workerUrl
              ? workerUrl
              : `${selectedService}.${workerUrl}`;
          const VLESS1 = `vless://${uuid}@${workerUrl}:80?encryption=none&type=ws&host=${workerUrl}&path=%2F${ip}-${port}&security=none&sni=#(${selectedService})+${country}+${isp}`;
          navigator.clipboard.writeText(VLESS1);
          Swal.fire({
            title: "Berhasil!",
            text: "COPY VLESS 80 SUKSES!",
            icon: "success",
            background: "rgba(6, 18, 67, 0.89)", // Warna latar belakang (biru pucat)
            color: "cyan", // Warna teks
            customClass: {
              popup: "rounded-popup",
            },
            confirmButtonColor: "#3085d6",
          });
        });

        row.querySelector(".copy-vless-clash").addEventListener("click", () => {
          const selectedService =
            row.querySelector(".service-selector").value || workerUrl;
          const domain =
            selectedService === workerUrl
              ? workerUrl
              : `${selectedService}.${workerUrl}`;
          const VLESSC = `- name: (${selectedService})+${country}+${isp}
      server: ${selectedService}
      port: 443
      type: vless
      uuid: ${uuid}
      cipher: auto
      tls: true
      udp: true
      skip-cert-verify: true
      network: ws
      servername: ${domain}
      ws-opts:
        path: /${ip}-${port}
        headers:
          Host: ${domain}`;
          navigator.clipboard.writeText(VLESSC);
          Swal.fire({
            title: "Berhasil!",
            text: "COPY VLESS CLASH 443 SUKSES!",
            icon: "success",
            background: "rgba(6, 18, 67, 0.89)", // Warna latar belakang (biru pucat)
            color: "cyan", // Warna teks
            customClass: {
              popup: "rounded-popup",
            },
            confirmButtonColor: "#3085d6",
          });
        });

        row
          .querySelector(".copy-vless-clash1")
          .addEventListener("click", () => {
            const selectedService =
              row.querySelector(".service-selector").value || workerUrl;
            const domain =
              selectedService === workerUrl
                ? workerUrl
                : `${selectedService}.${workerUrl}`;
            const VLESS2 = `- name: (${selectedService})+${country}+${isp}
      server: ${workerUrl}
      port: 80
      type: vless
      uuid: ${uuid}
      cipher: auto
      tls: false
      skip-cert-verify: false
      servername: ${workerUrl}
      network: ws
      ws-opts:
        path: /${ip}-${port}
        headers:
          Host: ${workerUrl}
      udp: true `;
            navigator.clipboard.writeText(VLESS2);
            Swal.fire({
              title: "Berhasil!",
              text: "COPY VLESS CLASH 80 SUKSES!",
              icon: "success",
              background: "rgba(6, 18, 67, 0.89)", // Warna latar belakang (biru pucat)
              color: "cyan", // Warna teks
              customClass: {
                popup: "rounded-popup",
              },
              confirmButtonColor: "#3085d6",
            });
          });

        row.querySelector(".copy-trojan").addEventListener("click", () => {
          const selectedService =
            row.querySelector(".service-selector").value || workerUrl;
          const domain =
            selectedService === workerUrl
              ? workerUrl
              : `${selectedService}.${workerUrl}`;
          const TROJAN = `trojan://${uuid}@${selectedService}:443?encryption=none&type=ws&host=${domain}&path=%2F${ip}-${port}&security=tls&sni=${domain}#(${selectedService})+${country}+${isp}`;
          navigator.clipboard.writeText(TROJAN);
          Swal.fire({
            title: "Berhasil!",
            text: "COPY TROJAN SUKSES!",
            icon: "success",
            background: "rgba(6, 18, 67, 0.89)", // Warna latar belakang (biru pucat)
            color: "cyan", // Warna teks
            customClass: {
              popup: "rounded-popup",
            },
            confirmButtonColor: "#3085d6",
          });
        });

        row
          .querySelector(".copy-trojan-clash")
          .addEventListener("click", () => {
            const selectedService =
              row.querySelector(".service-selector").value || workerUrl;
            const domain =
              selectedService === workerUrl
                ? workerUrl
                : `${selectedService}.${workerUrl}`;
            const TROJANC = `- name: (${selectedService})+${country}+${isp}
        server: ${selectedService}
        port: 443
        type: trojan
        password: ${uuid}
        skip-cert-verify: true
        sni: ${domain}
        network: ws
        ws-opts:
          path: /${ip}-${port}
          headers:
            Host: ${domain}
        udp: true `;
            navigator.clipboard.writeText(TROJANC);
            Swal.fire({
              title: "Berhasil!",
              text: "COPY TROJAN CLASH SUKSES!",
              icon: "success",
              background: "rgba(6, 18, 67, 0.89)", // Warna latar belakang (biru pucat)
              color: "cyan", // Warna teks
              customClass: {
                popup: "rounded-popup",
              },
              confirmButtonColor: "#3085d6",
            });
          });

        row.querySelector(".copy-shadowsock").addEventListener("click", () => {
          const selectedService =
            row.querySelector(".service-selector").value || workerUrl;
          const domain =
            selectedService === workerUrl
              ? workerUrl
              : `${selectedService}.${workerUrl}`;
          const SS = `ss://bm9uZTo1ZDJlYmQyYS05Y2I5LTRkMWItYWY1NS04NjE3ZDNlODFmMzk%3D@${selectedService}:443?encryption=none&type=ws&host=${domain}&path=%2F${ip}-${port}&security=tls&sni=${domain}#(${selectedService})+${country}+${isp}`;
          navigator.clipboard.writeText(SS);
          Swal.fire({
            title: "Berhasil!",
            text: "COPY SHADOWSOCK SUKSES!",
            icon: "success",
            background: "rgba(6, 18, 67, 0.89)", // Warna latar belakang (biru pucat)
            color: "cyan", // Warna teks
            customClass: {
              popup: "rounded-popup",
            },
            confirmButtonColor: "#3085d6",
          });
        });

        row
          .querySelector(".copy-shadowsock-clash")
          .addEventListener("click", () => {
            const SS1 = `087861167414`;
            navigator.clipboard.writeText(SS1);
            Swal.fire({
              title: "Perhatian!",
              text: "SHADOWSOCK VERSI CLASH BELUM TERSEDIA",
              icon: "warning",
              background: "rgba(6, 18, 67, 0.89)", // Warna latar belakang (biru pucat)
              color: "cyan", // Warna teks
              customClass: {
                popup: "rounded-popup",
              },
              confirmButtonColor: "#f39c12",
            });
          });
      });

      // Display total proxies
      const totalProxies = proxies.length;
      const totalProxyElement = document.getElementById("total-proxy");
      if (totalProxyElement) {
        totalProxyElement.textContent = `Total Proxies: ${totalProxies}`;
      }

      renderPagination(proxies, pagination);
    }

    // Function to render pagination
    // Function to render pagination
    function renderPagination(proxies, pagination) {
      const totalPages = Math.ceil(proxies.length / proxyPerPage);
      const maxButtons = 8;
      pagination.innerHTML = "";

      if (currentPage > 1) {
        const firstButton = document.createElement("button");
        firstButton.className =
          "border-cold-primary hover:bg-cold-primary/40 text-dark-text border-2 rounded-md py-2 px-4 mt-4";
        firstButton.textContent = "<< First";
        firstButton.addEventListener("click", () =>
          updatePage(1, proxies, pagination)
        );
        pagination.appendChild(firstButton);

        const prevButton = document.createElement("button");
        prevButton.className =
          "border-cold-primary hover:bg-cold-primary/40 text-dark-text border-2 rounded-md py-2 px-4 mt-4";
        prevButton.textContent = "Previous";
        prevButton.addEventListener("click", () =>
          updatePage(currentPage - 1, proxies, pagination)
        );
        pagination.appendChild(prevButton);
      }

      const startPage = Math.max(1, currentPage - Math.floor(maxButtons / 2));
      const endPage = Math.min(totalPages, startPage + maxButtons - 1);

      for (let i = startPage; i <= endPage; i++) {
        const pageButton = document.createElement("button");
        pageButton.className =
          "border-cold-primary hover:bg-cold-primary/40 text-dark-text border-2 rounded-md py-2 px-4 mt-4";

        pageButton.textContent = i;
        if (i === currentPage) {
          pageButton.classList.add("active");
          pageButton.className =
            "bg-cold-primary/20 border-cold-primary border-2 text-dark-text rounded-md py-2 px-4 mt-4";
        }
        pageButton.addEventListener("click", () =>
          updatePage(i, proxies, pagination)
        );
        pagination.appendChild(pageButton);
      }

      if (currentPage < totalPages) {
        const nextButton = document.createElement("button");
        nextButton.className =
          "border-cold-primary hover:bg-cold-primary/40 text-dark-text border-2 rounded-md py-2 px-4 mt-4";
        nextButton.textContent = "Next";
        nextButton.addEventListener("click", () =>
          updatePage(currentPage + 1, proxies, pagination)
        );
        pagination.appendChild(nextButton);

        const lastButton = document.createElement("button");
        lastButton.className =
          "border-cold-primary hover:bg-cold-primary/40 text-dark-text border-2 rounded-md py-2 px-4 mt-4";
        lastButton.textContent = "Last >>";
        lastButton.addEventListener("click", () =>
          updatePage(totalPages, proxies, pagination)
        );
        pagination.appendChild(lastButton);
      }
    }

    // Function to update page
    function updatePage(page, proxies, pagination) {
      currentPage = page;
      const proxyList = document.getElementById("proxy-list");
      renderProxies(proxies, proxyList, pagination);
    }

    // Function to filter proxies
    function filterProxies(searchTerm) {
      searchTerm = searchTerm.toLowerCase();
      filteredProxies = allProxies.filter((proxy) =>
        proxy.toLowerCase().includes(searchTerm)
      );
      currentPage = 1;
      const proxyList = document.getElementById("proxy-list");
      const pagination = document.getElementById("pagination");
      renderProxies(filteredProxies, proxyList, pagination);
    }

    // Event listener for search bar
    document.getElementById("search-bar").addEventListener("input", (e) => {
      filterProxies(e.target.value);
    });

    // Event listener for items per page dropdown
    document
      .getElementById("items-per-page")
      .addEventListener("change", (e) => {
        proxyPerPage = parseInt(e.target.value);
        const proxyList = document.getElementById("proxy-list");
        const pagination = document.getElementById("pagination");
        renderProxies(filteredProxies, proxyList, pagination);
      });

    // Fetching proxy data
    fetch(
      "https://raw.githubusercontent.com/BlueHat358/bluehat358-tunnel/refs/heads/main/proxy_list.txt"
    )
      .then((response) => response.text())
      .then((data) => {
        allProxies = data.split("\n").filter((line) => line.trim() !== "");
        filteredProxies = allProxies;
        const proxyList = document.getElementById("proxy-list");
        const pagination = document.getElementById("pagination");
        renderProxies(filteredProxies, proxyList, pagination);
      })
      .catch((error) => console.error("Error fetching proxy data:", error)); // Correct placement here

    async function onRequest(context) {
      const { request } = context;
      const url = new URL(request.url);

      const modifiedRequest = new Request(
        "https://p01--boiling-frame--kw6dd7bjv2nr.code.run/check" + url.search,
        {
          method: request.method,
          headers: request.headers,
          body: request.body,
        }
      );

      const response = await fetch(modifiedRequest);
      const modifiedResponse = new Response(response.body, response);

      return modifiedResponse;
    }

    // Check Proxy isActive function
    async function isProxyActive(ip, port = "443", button, index) {
      const latencyCell = button.parentElement.querySelector(".latency-cell"); // Find the latency span in the same cell
      let latencyWrapper = document.querySelector(
        `[lat-wrap-index="${index}"]`
      );
      const host = "speed.cloudflare.com";
      const tls = "true";
      let endTime = 0;
      let latency = 0; // Calculate latency
      let url = `${PROXY_HEALTH_CHECK_API}?ip=${ip}&port=${port}&host=${host}&tls=${tls}`;

      button.textContent = "Checking...";

      let startTime = performance.now();
      try {
        const response = await fetch(url, { method: "GET" }).then(
          (response) => {
            endTime = performance.now();
            latency = (endTime - startTime).toFixed(2); // Calculate latency
            return response;
          }
        );

        // Explicitly check if HTTP response is not OK
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        // Parse JSON response
        const data = await response.json();
        console.log(data);

        // Extract proxy status from response
        const isProxy = data.proxyip ? "Yes" : "No";

        if (isProxy === "Yes") {
          latencyWrapper.classList.remove("hidden");
          button.textContent = "ACTIVE";
          button.style.backgroundColor = "green";
          button.style.color = "cyan";
          latencyCell.textContent = `${latency} ms`;

          // Display success popup
          Swal.fire({
            title: "Proxy Status: ACTIVE",
            text: `${latency} ms.`,
            icon: "success",
            background: "rgba(6, 18, 67, 0.89)",
            color: "cyan",
            customClass: {
              popup: "rounded-popup",
            },
            confirmButtonColor: "#3085d6",
          });
        } else {
          button.textContent = "DEAD";
          button.style.backgroundColor = "red";
          button.style.color = "cyan";
          latencyCell.textContent = "";

          // Display error popup
          Swal.fire({
            title: "Proxy Status: DEAD",
            text: "Proxy is not active.",
            icon: "error",
            background: "rgba(6, 18, 67, 0.89)",
            color: "white",
            customClass: {
              popup: "rounded-popup",
            },
            confirmButtonColor: "#d33",
          });
        }
      } catch (error) {
        console.error("Error:", error);

        endTime = performance.now();
        latency = (endTime - startTime).toFixed(2); // Calculate latency even in error case

        button.textContent = "DEAD";
        button.style.backgroundColor = "red";
        button.style.color = "cyan";
        latencyCell.textContent = ""; // Clear latency cell text on failure

        // Display error popup
        Swal.fire({
          title: "Proxy Status: DEAD",
          text: `Error: ${error.message}`,
          icon: "error",
          background: "rgba(6, 18, 67, 0.89)",
          color: "white",
          customClass: {
            popup: "rounded-popup",
          },
          confirmButtonColor: "#d33",
        });
      }
    }
  </script>
</html>
